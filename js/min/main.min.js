function init(){isTouch="ontouchstart"in window,console.log("isTouch : ",isTouch),document.onselectstart=new Function("return false"),buildGrid(),soundz=new Howl({urls:["sounds/2040.mp3"],autoplay:!1,buffer:!0}),$("#startGame").click(start)}function buildGrid(){for(var t=0;totalSquare>t;t++){var o={},e=Math.floor(t/lineLength),n=t%lineLength;o.ignore=!1,o.tl=n*squareWidth,o.tr=n*squareWidth+squareWidth,o.bl=e*squareHeight,o.br=e*squareHeight+squareHeight,tabGrid.push(o)}console.log("tabgrid",tabGrid)}function start(){$("#startGame").remove(),chrono=new Chrono($("#chrono")),countdown=new Countdown($("#countdown"),3),countdown.start(),$(countdown).on("onComplete",completeCountdown)}function completeCountdown(){$("#wrapper").bind("touchstart",onTouchStart),countdown=null,$("#countdown").remove();for(var t=0;NB_ITEM>t;t++){var o=tabImage[random(0,tabImage.length-1,1)],e=new app.Models.ItemModel;e.set("image",o.src),e.set("width",o.width),e.set("height",o.height);var n=e.get("width"),i=e.get("height"),r=random(2,tabGrid.length-1,1),a=tabGrid[r];tabGrid.splice(r,1);var u,h,c,s;u=a.tl,0>u&&(u=0),h=u+(squareWidth-n),0>h&&(h=0),c=a.bl,0>c&&(c=0),s=c+(squareHeight-i),0>s&&(s=0);var d=random(u,h,1),l=random(c,s,1);e.set("posX",d),e.set("posY",l);var g=new app.Views.ItemView({model:e});tabItem.push(g),$("#wrapper").append(g.render().el),g.on("click",clickItem)}animateItem(),chrono.start()}function animateItem(){for(var t=0;t<tabItem.length;t++)$(tabItem[t].el).delay(20*t).fadeIn(300)}function clickItem(){soundz.play(),this.remove(),count++,count==NB_ITEM&&(timeResult=chrono.getResult(),finish())}function onTouchStart(t){t.preventDefault(),touchDown=!0;var o=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=$(this).offset(),n=o.pageX-e.left,i=o.pageY-e.top;touchBeginPosition={x:n,y:i},$("#wrapper").bind("touchmove",onTouchMove),$("#wrapper").bind("touchend",onTouchEnd)}function onTouchMove(t){t.preventDefault();var o=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=$(this).offset(),n=o.pageX-e.left,i=o.pageY-e.top;console.log("ontouchmove",n,i)}function onTouchEnd(t){touchMoved&&t.preventDefault();var o=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],e=$(this).offset(),n=o.pageX-e.left,i=o.pageY-e.top;touchEndPosition={x:n,y:i},$("#wrapper").unbind("touchmove",onTouchMove),$("#wrapper").unbind("touchend",onTouchEnd),touchDown=!1,console.log("position de départ",touchBeginPosition),console.log("position de fin",touchEndPosition)}function finish(){chrono.stop(),setTimeout(function(){alert("Votre résultat : "+timeResult)},100)}function random(t,o,e){if(e&&null!=e&&void 0!=e||(e=1),t>o){var n=t;t=o,o=n}var i=o-t+1*e,r=Math.random()*i;return r+=t,floor(r,e)}function floor(t,o){return Math.floor(t/o)*o}var chrono,countdown,NB_ITEM=10,tabItem=[],count=0,timeResult,tabImage=[{src:"img/50x50.jpg",width:50,height:50},{src:"img/60x60.jpg",width:60,height:60},{src:"img/70x70.jpg",width:70,height:70}],stageWidth=990,stageHeight=500,lineLength=8,totalSquare=32,squareWidth=Math.floor(stageWidth/lineLength),squareHeight=Math.floor(stageHeight/(totalSquare/lineLength)),tabGrid=[],tabItem=[],isTouch,touchMoved,touchDown,touchBeginPosition,touchEndPosition,isLinkTouch,soundz;$(document).ready(init);